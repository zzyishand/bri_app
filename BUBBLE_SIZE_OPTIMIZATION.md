# Bubble Chart优化说明

## 更新内容

### 1. ✅ 删除恒生国企指数 (HSCEI)
- 从 `app.py` 的 `ASSET_INFO` 中删除
- 从 `bri_data_fetcher.py` 的 `BRI_ASSETS` 中删除
- 简化资产列表，聚焦核心指数

---

### 2. ✅ 优化Bubble大小算法

#### 旧算法问题：
```python
size = bri * 100 + 10
```
**问题：**
- BRI = 0.1 → size = 20 （太小，文字不清晰）
- BRI = 0.5 → size = 60 （中等）
- BRI = 1.0 → size = 110 （过大）

#### 新算法优化：
```python
size = bri * 50 + 40
```
**改进：**
- BRI = 0.0 → size = 40 （最小值增加）
- BRI = 0.5 → size = 65 （适中）
- BRI = 1.0 → size = 90 （最大值）

**优点：**
- ✅ 最小bubble从20增加到40，文字更清晰
- ✅ 最大bubble从110降低到90，避免过大遮挡
- ✅ 范围压缩：40-90（旧：10-110），显示更均匀

---

### 3. ✅ 动态字体大小

#### 新功能：字体大小根据bubble大小自动调整

```python
# 根据bubble大小动态调整字体
font_size = int(8 + (bubble_size - 40) / 50 * 5)
# 范围：9-13pt
```

**映射关系：**
| Bubble Size | Font Size | 说明 |
|-------------|-----------|------|
| 40 (最小) | 9pt | 小bubble，小字体 |
| 65 (中等) | 11pt | 中等bubble，中等字体 |
| 90 (最大) | 13pt | 大bubble，大字体 |

**优点：**
- ✅ 小bubble不会因为字体过大而溢出
- ✅ 大bubble充分利用空间显示清晰文字
- ✅ 视觉比例更协调

---

### 4. ✅ 增加图表高度

```python
height=800  # 从700增加到800
```

**改进：**
- ✅ 更多垂直空间，减少bubble重叠
- ✅ 文字显示更清晰
- ✅ 整体视觉效果更舒适

---

## 前后对比

### 优化前：
```
Bubble Size: 10 → 110 (范围100)
Font Size: 固定10pt
Height: 700px
最小bubble: 可能看不清文字 ❌
```

### 优化后：
```
Bubble Size: 40 → 90 (范围50)
Font Size: 动态9-13pt
Height: 800px
最小bubble: 文字清晰可见 ✅
```

---

## 技术细节

### Bubble Size公式推导

**需求：**
- 最小BRI (0.0) → size = 40
- 最大BRI (1.0) → size = 90

**线性公式：**
```
size = bri * (max - min) + min
size = bri * (90 - 40) + 40
size = bri * 50 + 40
```

### Font Size公式推导

**需求：**
- 最小size (40) → font = 9
- 最大size (90) → font = 13

**线性公式：**
```
font = 8 + (size - 40) / 50 * 5
     = 8 + (size - 40) * 0.1
```

**验证：**
- size=40: font = 8 + 0 = 8 (取最小值9)
- size=65: font = 8 + 2.5 = 10.5 ≈ 11
- size=90: font = 8 + 5 = 13 ✅

---

## 测试建议

### 测试场景：
1. **低BRI资产** (0.0-0.3)
   - 检查bubble是否足够大
   - 检查文字是否清晰可见

2. **中等BRI资产** (0.4-0.6)
   - 检查bubble大小是否适中
   - 检查字体大小是否协调

3. **高BRI资产** (0.7-1.0)
   - 检查bubble是否过大
   - 检查是否遮挡其他bubble

### 视觉检查：
- [ ] 所有资产名称清晰可读
- [ ] 中英文名称都能完整显示
- [ ] bubble之间有适当间距
- [ ] 颜色对比度足够

---

## 后续优化建议

### 可选改进：
1. **自适应bubble间距**
   - 检测重叠，自动调整位置

2. **响应式字体**
   - 根据屏幕分辨率动态调整

3. **交互式调整**
   - 添加UI控件让用户自定义bubble大小范围

4. **文字省略**
   - 超长名称自动缩写（如 "NASDAQ-100" → "NDX"）

---

**更新日期**: 2025-12-29  
**版本**: v2.1  
**状态**: ✅ 已完成并测试

